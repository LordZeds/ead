export const runtime = 'nodejs';
import { NextRequest,NextResponse } from 'next/server';import { db } from '@/db/client';import { users } from '@/db/schema';import { eq } from 'drizzle-orm';import { hashPassword } from '@/lib/crypto';export async function POST(req:NextRequest){const {email,password,name}=await req.json();const exists=(await db.select().from(users).where(eq(users.email,email)).limit(1))[0];if(exists)return NextResponse.json({message:'Email already in use'},{status:400});const passwordHash=await hashPassword(password);const row=await db.insert(users).values({email,passwordHash,name:name??null,role:'student'}).returning();return NextResponse.json({id:row[0].id});}

'use client';
import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
export default function CourseDetailPage(){const {id}=useParams<{id:string}>();const [data,setData]=useState<any>(null);const [playing,setPlaying]=useState<any>(null);const [msg,setMsg]=useState('');useEffect(()=>{(async()=>{const r=await fetch(`/api/courses/${id}`);if(r.ok)setData(await r.json());})()},[id]);async function complete(lessonId:string){setMsg('');const r=await fetch(`/api/lessons/${lessonId}/complete`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({progressPct:100})});if(!r.ok){setMsg('Erro ao marcar lição');return;}setMsg('Lição marcada como concluída')}if(!data)return <main className="p-6">Carregando...</main>;return(<main className="p-6 space-y-6"><h1 className="title">{data.course.title}</h1>{playing&&(<section className="space-y-2"><h2 className="font-semibold">{playing.title}</h2>{playing.videoUrl?(<video className="w-full rounded" src={playing.videoUrl} controls/>):(<div className="p-4 border rounded">Sem vídeo para esta lição.</div>)}<div className="flex gap-2"><button onClick={()=>complete(playing.id)} className="btn btn-sm">Marcar como concluída</button>{msg&&<span className="text-sm">{msg}</span>}</div></section>)}<section className="space-y-3"><h2 className="subtitle">Conteúdo</h2><div className="space-y-4">{data.content.map((m:any)=>(<div key={m.module.id} className="card"><h3 className="font-medium">{m.module.title}</h3><ul className="mt-2 space-y-2">{m.lessons.map((l:any)=>(<li key={l.id} className="flex items-center justify-between"><span>{l.title}</span><div className="flex gap-2"><button onClick={()=>setPlaying(l)} className="btn btn-outline btn-sm">Assistir</button><button onClick={()=>complete(l.id)} className="btn btn-outline btn-sm">Concluir</button></div></li>))}</ul></div>))}</div></section></main>)}
